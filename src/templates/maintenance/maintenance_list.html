{% extends "base.html" %}
{% load static %}

{% block title %}家電・設備メンテ{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/components/button.css' %}">
<link rel="stylesheet" href="{% static 'css/components/top_nav.css' %}">
<link rel="stylesheet" href="{% static 'css/components/bottom_nav.css' %}">
<style>
  .grid-2col { display:grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .panel { background: var(--bg-surface,#fff); border:1px solid #eee; border-radius:10px; padding:12px; }
  .panel h3 { margin: 0 0 8px; }
  .item { border-bottom:1px dashed #eee; padding:8px 0; }
  .item:last-child { border-bottom:none; }
  .muted { color:#888; font-size:.9rem; }
  dialog { border: none; border-radius: 10px; padding: 0; width:min(520px,92%); }
  .dlg-body { padding: 16px; }
  .dlg-head { padding: 12px 16px; background:#fafafa; border-bottom:1px solid #eee; font-weight:600; }
  .dlg-foot { padding: 12px 16px; display:flex; gap:8px; justify-content:flex-end; }
</style>
{% endblock %}

{% block header %}{% include "components/top_nav.html" %}{% endblock %}
{% block page_title %}家電・設備メンテ{% endblock %}

{% block content %}
<div class="grid-2col">
  <div class="panel">
    <h3>家電</h3>
    {% for m in appliances %}
      <div class="item">
        <div><strong>{{ m.target_name }}</strong></div>
        <div class="muted">
          最終: {{ m.last_date|date:"Y/m/d" }} /
          次回: {{ m.next_date|date:"Y/m/d" }} /
          タスク日: {{ m.task_date|date:"Y/m/d" }}
        </div>
      </div>
    {% empty %}
      <p class="muted">登録なし</p>
    {% endfor %}
  </div>

  <div class="panel">
    <h3>設備</h3>
    {% for m in facilities %}
      <div class="item">
        <div><strong>{{ m.target_name }}</strong></div>
        <div class="muted">
          最終: {{ m.last_date|date:"Y/m/d" }} /
          次回: {{ m.next_date|date:"Y/m/d" }} /
          タスク日: {{ m.task_date|date:"Y/m/d" }}
        </div>
      </div>
    {% empty %}
      <p class="muted">登録なし</p>
    {% endfor %}
  </div>
</div>

<p class="link_set" style="margin-top:18px; display:flex; gap:12px; justify-content:center;">
  <button class="btn btn-primary" onclick="document.getElementById('dlg-add').showModal()">＋ 追加</button>
  <button class="btn btn-secondary" onclick="document.getElementById('dlg-del').showModal()">削除</button>
</p>

<!-- 追加ダイアログ -->
<dialog id="dlg-add">
  <div class="dlg-head">項目を追加</div>
  <form method="post" action="{% url 'maintenance:create' %}">
    <div class="dlg-body">
      {% csrf_token %}
      <div class="form_group">
        <label>区分</label>
        {{ add_form.is_appliance }}
      </div>
      <div class="form_group">
        <label>名称</label>
        {{ add_form.target_name }}
      </div>
      <div class="form_group">
        <label>頻度</label>
        {{ add_form.frequency }}
      </div>
      <div class="form_group">
        <label>最後に実施した日</label>
        {{ add_form.last_date }}
      </div>
    </div>
    <div class="dlg-foot">
      <button class="btn btn-secondary" type="button" onclick="document.getElementById('dlg-add').close()">閉じる</button>
      <button class="btn btn-primary" type="submit">追加</button>
    </div>
  </form>
</dialog>

<!-- 削除ダイアログ -->
<dialog id="dlg-del">
  <div class="dlg-head">項目を削除</div>
  <form method="post" action="{% url 'maintenance:delete' %}">
    <div class="dlg-body">
      {% csrf_token %}
      {{ del_form.item_id }}
    </div>
    <div class="dlg-foot">
      <button class="btn btn-secondary" type="button" onclick="document.getElementById('dlg-del').close()">閉じる</button>
      <button class="btn btn-danger" type="submit" onclick="return confirm('削除しますか？')">削除</button>
    </div>
  </form>
</dialog>
{% endblock %}

{% block footer %}{% include "components/bottom_nav.html" %}{% endblock %}
